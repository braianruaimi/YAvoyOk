<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones Push Mejoradas - YaVoy 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: #0b1220;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #ffffff;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #0b1220;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h3 {
            font-size: 1.3em;
            color: #ffffff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .status-enabled {
            background: #dcfce7;
            color: #166534;
        }

        .status-disabled {
            background: #0f1724;
            color: #991b1b;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #0f1724;
            color: #ffffff;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #06b6d4;
        }

        .notification-preview {
            background: #0f1724;
            border-left: 4px solid #06b6d4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .notification-preview h4 {
            font-size: 1em;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .notification-preview p {
            font-size: 0.9em;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .notification-preview .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .notification-templates {
            display: grid;
            gap: 10px;
        }

        .template-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #0b1220;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .template-btn:hover {
            border-color: #06b6d4;
            background: #0f1724;
        }

        .template-btn strong {
            display: block;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .template-btn span {
            font-size: 0.9em;
            color: #ffffff;
        }

        .notification-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            background: #0f1724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #06b6d4;
        }

        .notification-item.success {
            border-left-color: #10b981;
        }

        .notification-item.error {
            border-left-color: #ef4444;
        }

        .notification-item .header-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .notification-item .title {
            font-weight: 600;
            color: #ffffff;
        }

        .notification-item .time {
            font-size: 0.85em;
            color: #cccccc;
        }

        .notification-item .body {
            font-size: 0.9em;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .notification-item .stats {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #ffffff;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            margin: 0;
            font-weight: 500;
            color: #ffffff;
        }

        .icon-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .icon-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #0b1220;
            cursor: pointer;
            text-align: center;
            font-size: 1.8em;
            transition: all 0.3s;
        }

        .icon-option:hover,
        .icon-option.selected {
            border-color: #06b6d4;
            background: #0f1724;
            transform: scale(1.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #0f1724;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: bold;
            color: #06b6d4;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 0.9em;
            color: #ffffff;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîî Notificaciones Push Mejoradas</h1>
            <p>Sistema avanzado de notificaciones en tiempo real para YaVoy</p>
        </div>

        <!-- Grid Principal -->
        <div class="grid">
            <!-- Estado del Sistema -->
            <div class="card">
                <h3>üì° Estado del Sistema</h3>
                <div class="status-badge status-disabled" id="statusBadge">
                    <div class="status-dot"></div>
                    <span>Notificaciones Deshabilitadas</span>
                </div>

                <button class="btn btn-success" id="enableBtn" onclick="solicitarPermiso()">
                    ‚úÖ Habilitar Notificaciones
                </button>
                <button class="btn btn-danger hidden" id="disableBtn" onclick="deshabilitarNotificaciones()">
                    üîï Deshabilitar
                </button>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="number" id="statEnviadas">0</div>
                        <div class="label">Enviadas</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="statExitosas">0</div>
                        <div class="label">Exitosas</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="statFallidas">0</div>
                        <div class="label">Fallidas</div>
                    </div>
                </div>
            </div>

            <!-- Plantillas R√°pidas -->
            <div class="card">
                <h3>üìã Plantillas R√°pidas</h3>
                <div class="notification-templates">
                    <button class="template-btn" onclick="aplicarPlantilla('pedido')">
                        <strong>üõçÔ∏è Nuevo Pedido</strong>
                        <span>Notificar nuevo pedido recibido</span>
                    </button>
                    <button class="template-btn" onclick="aplicarPlantilla('entrega')">
                        <strong>üö¥ En Camino</strong>
                        <span>Pedido en ruta de entrega</span>
                    </button>
                    <button class="template-btn" onclick="aplicarPlantilla('completado')">
                        <strong>‚úÖ Entregado</strong>
                        <span>Pedido entregado exitosamente</span>
                    </button>
                    <button class="template-btn" onclick="aplicarPlantilla('promocion')">
                        <strong>üéâ Promoci√≥n</strong>
                        <span>Ofertas y promociones especiales</span>
                    </button>
                    <button class="template-btn" onclick="aplicarPlantilla('alerta')">
                        <strong>‚ö†Ô∏è Alerta</strong>
                        <span>Mensaje urgente o importante</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Crear Notificaci√≥n -->
        <div class="card">
            <h3>‚úâÔ∏è Crear Notificaci√≥n Personalizada</h3>
            
            <div class="form-group">
                <label>Destinatarios</label>
                <select id="destinatarios" aria-label="Seleccionar destinatarios de la notificaci√≥n">
                    <option value="todos">üì¢ Todos los usuarios</option>
                    <option value="comercios">üè™ Solo Comercios</option>
                    <option value="repartidores">üö¥ Solo Repartidores</option>
                    <option value="clientes">üë§ Solo Clientes</option>
                    <option value="especifico">üéØ Usuario Espec√≠fico</option>
                </select>
            </div>

            <div class="form-group hidden" id="usuarioEspecificoGroup">
                <label>ID o Email del Usuario</label>
                <input type="text" id="usuarioEspecifico" placeholder="Ej: usuario@email.com">
            </div>

            <div class="form-group">
                <label>Icono de Notificaci√≥n</label>
                <div class="icon-selector">
                    <div class="icon-option selected" data-icon="üîî" onclick="seleccionarIcono('üîî')">üîî</div>
                    <div class="icon-option" data-icon="üì¶" onclick="seleccionarIcono('üì¶')">üì¶</div>
                    <div class="icon-option" data-icon="üö¥" onclick="seleccionarIcono('üö¥')">üö¥</div>
                    <div class="icon-option" data-icon="‚úÖ" onclick="seleccionarIcono('‚úÖ')">‚úÖ</div>
                    <div class="icon-option" data-icon="‚ö†Ô∏è" onclick="seleccionarIcono('‚ö†Ô∏è')">‚ö†Ô∏è</div>
                    <div class="icon-option" data-icon="üéâ" onclick="seleccionarIcono('üéâ')">üéâ</div>
                    <div class="icon-option" data-icon="üí∞" onclick="seleccionarIcono('üí∞')">üí∞</div>
                    <div class="icon-option" data-icon="‚≠ê" onclick="seleccionarIcono('‚≠ê')">‚≠ê</div>
                </div>
            </div>

            <div class="form-group">
                <label>T√≠tulo</label>
                <input type="text" id="titulo" placeholder="Ej: ¬°Nuevo pedido recibido!">
            </div>

            <div class="form-group">
                <label>Mensaje</label>
                <textarea id="mensaje" rows="3" placeholder="Escribe el mensaje de la notificaci√≥n..."></textarea>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="conSonido">
                <label for="conSonido">Reproducir sonido</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="conVibracion">
                <label for="conVibracion">Vibraci√≥n (m√≥vil)</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="requiereAccion">
                <label for="requiereAccion">Requiere acci√≥n del usuario</label>
            </div>

            <div class="form-group hidden" id="urlAccionGroup">
                <label>URL de Acci√≥n</label>
                <input type="text" id="urlAccion" placeholder="Ej: /panel-comercio.html">
            </div>

            <div class="notification-preview" id="preview">
                <div class="icon" id="previewIcon">üîî</div>
                <h4 id="previewTitulo">Vista Previa</h4>
                <p id="previewMensaje">El mensaje aparecer√° aqu√≠...</p>
            </div>

            <div class="margin-top-20">
                <button class="btn btn-primary" onclick="enviarNotificacion()">
                    üì§ Enviar Notificaci√≥n
                </button>
                <button class="btn btn-secondary" onclick="testearNotificacion()">
                    üß™ Probar (Solo yo)
                </button>
                <button class="btn btn-secondary" onclick="limpiarFormulario()">
                    üóëÔ∏è Limpiar
                </button>
            </div>
        </div>

        <!-- Historial -->
        <div class="card">
            <h3>üìú Historial de Notificaciones</h3>
            <div class="notification-history" id="historial">
                <p class="text-center-gray">
                    No hay notificaciones enviadas a√∫n
                </p>
            </div>
        </div>
    </div>

    <script>
        let notificacionesHabilitadas = false;
        let iconoSeleccionado = 'üîî';
        let stats = { enviadas: 0, exitosas: 0, fallidas: 0 };
        let historialNotificaciones = [];

        // Configuraci√≥n VAPID - DEBE COINCIDIR CON .env
        const VAPID_PUBLIC_KEY = 'BL4P9zTOxEkQBAmTV3XiyK9305PJDZKoPr52a0NNedpV5OVfuZGlf9SL21zVE9D4AwNfgWzKw8bHA-peL_g-qZs';

        // Inicializar
        window.addEventListener('DOMContentLoaded', () => {
            verificarEstado();
            setupEventListeners();
            cargarHistorial();
        });

        function setupEventListeners() {
            // Actualizar preview en tiempo real
            document.getElementById('titulo').addEventListener('input', actualizarPreview);
            document.getElementById('mensaje').addEventListener('input', actualizarPreview);
            
            // Mostrar campo de usuario espec√≠fico
            document.getElementById('destinatarios').addEventListener('change', (e) => {
                const group = document.getElementById('usuarioEspecificoGroup');
                group.style.display = e.target.value === 'especifico' ? 'block' : 'none';
            });

            // Mostrar campo de URL de acci√≥n
            document.getElementById('requiereAccion').addEventListener('change', (e) => {
                const group = document.getElementById('urlAccionGroup');
                group.style.display = e.target.checked ? 'block' : 'none';
            });
        }

        async function verificarEstado() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    notificacionesHabilitadas = true;
                    actualizarUI();
                }
            }
        }

        async function solicitarPermiso() {
            if (!('Notification' in window)) {
                alert('Este navegador no soporta notificaciones push');
                return;
            }

            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    notificacionesHabilitadas = true;
                    actualizarUI();
                    
                    // Registrar Service Worker
                    if ('serviceWorker' in navigator) {
                        const registration = await navigator.serviceWorker.register('/sw.js');
                        console.log('Service Worker registrado:', registration);
                        
                        // Suscribirse a push notifications
                        await suscribirPushNotifications(registration);
                    }
                    
                    // Mostrar notificaci√≥n de bienvenida
                    new Notification('üéâ ¬°Notificaciones Habilitadas!', {
                        body: 'Ahora recibir√°s actualizaciones en tiempo real de YaVoy',
                        icon: '/icons/icon-192x192.png'
                    });
                } else {
                    alert('Permiso de notificaciones denegado');
                }
            } catch (error) {
                console.error('Error al solicitar permiso:', error);
                alert('Error al habilitar notificaciones');
            }
        }

        async function suscribirPushNotifications(registration) {
            try {
                const subscription = await registration.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
                });

                // Enviar suscripci√≥n al servidor
                await fetch('http://localhost:5501/api/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(subscription)
                });

                console.log('Suscripci√≥n push registrada');
            } catch (error) {
                console.error('Error al suscribirse a push:', error);
            }
        }

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }

        function deshabilitarNotificaciones() {
            notificacionesHabilitadas = false;
            actualizarUI();
        }

        function actualizarUI() {
            const badge = document.getElementById('statusBadge');
            const enableBtn = document.getElementById('enableBtn');
            const disableBtn = document.getElementById('disableBtn');

            if (notificacionesHabilitadas) {
                badge.className = 'status-badge status-enabled';
                badge.innerHTML = '<div class="status-dot"></div><span>Notificaciones Habilitadas</span>';
                enableBtn.style.display = 'none';
                disableBtn.style.display = 'inline-flex';
            } else {
                badge.className = 'status-badge status-disabled';
                badge.innerHTML = '<div class="status-dot"></div><span>Notificaciones Deshabilitadas</span>';
                enableBtn.style.display = 'inline-flex';
                disableBtn.style.display = 'none';
            }

            // Actualizar stats
            document.getElementById('statEnviadas').textContent = stats.enviadas;
            document.getElementById('statExitosas').textContent = stats.exitosas;
            document.getElementById('statFallidas').textContent = stats.fallidas;
        }

        function seleccionarIcono(icono) {
            iconoSeleccionado = icono;
            document.querySelectorAll('.icon-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
            actualizarPreview();
        }

        function actualizarPreview() {
            const titulo = document.getElementById('titulo').value || 'Vista Previa';
            const mensaje = document.getElementById('mensaje').value || 'El mensaje aparecer√° aqu√≠...';
            
            document.getElementById('previewIcon').textContent = iconoSeleccionado;
            document.getElementById('previewTitulo').textContent = titulo;
            document.getElementById('previewMensaje').textContent = mensaje;
        }

        function aplicarPlantilla(tipo) {
            const plantillas = {
                pedido: {
                    icono: 'üì¶',
                    titulo: '¬°Nuevo Pedido Recibido!',
                    mensaje: 'Tienes un nuevo pedido esperando confirmaci√≥n. Toca para ver detalles.'
                },
                entrega: {
                    icono: 'üö¥',
                    titulo: 'Tu pedido est√° en camino',
                    mensaje: 'El repartidor est√° en camino. Tiempo estimado: 25 minutos.'
                },
                completado: {
                    icono: '‚úÖ',
                    titulo: '¬°Pedido Entregado!',
                    mensaje: 'Tu pedido ha sido entregado exitosamente. ¬°Gracias por usar YaVoy!'
                },
                promocion: {
                    icono: 'üéâ',
                    titulo: '¬°Oferta Especial!',
                    mensaje: '20% de descuento en tu pr√≥ximo pedido. V√°lido por 24 horas.'
                },
                alerta: {
                    icono: '‚ö†Ô∏è',
                    titulo: 'Atenci√≥n Requerida',
                    mensaje: 'Hay un problema con tu pedido. Por favor revisa los detalles.'
                }
            };

            const plantilla = plantillas[tipo];
            seleccionarIcono(plantilla.icono);
            document.getElementById('titulo').value = plantilla.titulo;
            document.getElementById('mensaje').value = plantilla.mensaje;
            actualizarPreview();
        }

        async function enviarNotificacion() {
            if (!notificacionesHabilitadas) {
                alert('Primero habilita las notificaciones');
                return;
            }

            const titulo = document.getElementById('titulo').value.trim();
            const mensaje = document.getElementById('mensaje').value.trim();
            const destinatarios = document.getElementById('destinatarios').value;

            if (!titulo || !mensaje) {
                alert('Por favor completa t√≠tulo y mensaje');
                return;
            }

            try {
                const notificacion = {
                    titulo,
                    mensaje,
                    icono: iconoSeleccionado,
                    destinatarios,
                    conSonido: document.getElementById('conSonido').checked,
                    conVibracion: document.getElementById('conVibracion').checked,
                    urlAccion: document.getElementById('urlAccion').value || null,
                    timestamp: new Date().toISOString()
                };

                // Enviar al servidor
                const response = await fetch('http://localhost:5501/api/send-notification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(notificacion)
                });

                if (response.ok) {
                    stats.enviadas++;
                    stats.exitosas++;
                    agregarAlHistorial(notificacion, 'success');
                    alert('‚úÖ Notificaci√≥n enviada exitosamente');
                    limpiarFormulario();
                } else {
                    throw new Error('Error al enviar');
                }
            } catch (error) {
                console.error('Error:', error);
                stats.fallidas++;
                alert('‚ùå Error al enviar notificaci√≥n');
            }

            actualizarUI();
        }

        function testearNotificacion() {
            if (!notificacionesHabilitadas) {
                alert('Primero habilita las notificaciones');
                return;
            }

            const titulo = document.getElementById('titulo').value.trim() || 'Prueba de Notificaci√≥n';
            const mensaje = document.getElementById('mensaje').value.trim() || 'Este es un mensaje de prueba';

            const options = {
                body: mensaje,
                icon: '/icons/icon-192x192.png',
                badge: '/icons/icon-96x96.png',
                vibrate: document.getElementById('conVibracion').checked ? [200, 100, 200] : undefined,
                silent: !document.getElementById('conSonido').checked,
                data: {
                    url: document.getElementById('urlAccion').value || '/'
                }
            };

            new Notification(`${iconoSeleccionado} ${titulo}`, options);
            
            stats.enviadas++;
            stats.exitosas++;
            actualizarUI();
        }

        function agregarAlHistorial(notificacion, estado) {
            historialNotificaciones.unshift({
                ...notificacion,
                estado,
                hora: new Date().toLocaleTimeString('es-AR')
            });

            if (historialNotificaciones.length > 20) {
                historialNotificaciones = historialNotificaciones.slice(0, 20);
            }

            renderizarHistorial();
        }

        function renderizarHistorial() {
            const historial = document.getElementById('historial');
            
            if (historialNotificaciones.length === 0) {
                historial.innerHTML = '<p class="text-center-gray">No hay notificaciones enviadas a√∫n</p>';
                return;
            }

            historial.innerHTML = historialNotificaciones.map(n => `
                <div class="notification-item ${n.estado}">
                    <div class="header-item">
                        <span class="title">${n.icono} ${n.titulo}</span>
                        <span class="time">${n.hora}</span>
                    </div>
                    <div class="body">${n.mensaje}</div>
                    <div class="stats">
                        <span>üë• ${n.destinatarios}</span>
                        ${n.conSonido ? '<span>üîä Sonido</span>' : ''}
                        ${n.conVibracion ? '<span>üì≥ Vibraci√≥n</span>' : ''}
                    </div>
                </div>
            `).join('');
        }

        function cargarHistorial() {
            // Cargar desde localStorage si existe
            const guardado = localStorage.getItem('yavoy_historial_notificaciones');
            if (guardado) {
                historialNotificaciones = JSON.parse(guardado);
                renderizarHistorial();
            }
        }

        function limpiarFormulario() {
            document.getElementById('titulo').value = '';
            document.getElementById('mensaje').value = '';
            document.getElementById('destinatarios').value = 'todos';
            document.getElementById('conSonido').checked = false;
            document.getElementById('conVibracion').checked = false;
            document.getElementById('requiereAccion').checked = false;
            document.getElementById('urlAccion').value = '';
            seleccionarIcono('üîî');
            actualizarPreview();
        }

        // Guardar historial antes de cerrar
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('yavoy_historial_notificaciones', JSON.stringify(historialNotificaciones));
        });
    </script>
</body>
</html>
