<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CEO - YaVoy 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #050810 0%, #0a0f1a 50%, #0d1117 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Login Screen */
        #loginScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: #0b1220;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 2em;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-subtitle {
            color: #ffffff;
            font-size: 0.95em;
            opacity: 0.8;
        }

        .ceo-select {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .ceo-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ceo-option:hover {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.1);
            transform: translateY(-3px);
        }

        .ceo-option.selected {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.2);
        }

        .ceo-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            margin: 0 auto 10px;
            font-weight: 700;
        }

        .ceo-name {
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1em;
        }

        .login-form {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #06b6d4;
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.4);
        }

        .btn-login:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .error-message {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        /* Dashboard Screen */
        #dashboardScreen {
            display: none;
        }

        #dashboardScreen.active {
            display: block;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: #0b1220;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .fecha-actual {
            font-size: 1.1em;
            color: #ffffff;
        }

        .refresh-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.3s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .kpi-card {
            background: #0b1220;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #06b6d4, #0891b2);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .kpi-icon {
            font-size: 2.5em;
            opacity: 0.8;
        }

        .kpi-trend {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .trend-up {
            background: #dcfce7;
            color: #166534;
        }

        .trend-down {
            background: #0f1724;
            color: #991b1b;
        }

        .kpi-value {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .kpi-label {
            color: #ffffff;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .kpi-sublabel {
            font-size: 0.85em;
            color: #cccccc;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: #0b1220;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #ffffff;
            font-size: 1.3em;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Full Width Charts */
        .full-chart {
            grid-column: 1 / -1;
        }

        .full-chart .chart-container {
            height: 400px;
        }

        /* Tables */
        .table-card {
            background: #0b1220;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .table-card h3 {
            margin-bottom: 20px;
            color: #ffffff;
            font-size: 1.3em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #3a4a5c;
            color: #ffffff;
        }

        tbody tr:hover {
            background: #0f1724;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #0f1724;
            color: #92400e;
        }

        .badge-danger {
            background: #0f1724;
            color: #991b1b;
        }

        /* Bot√≥n Flotante de Chat */
        .chat-float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            text-decoration: none;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .chat-float-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 12px 35px rgba(6, 182, 212, 0.6);
        }

        .chat-float-btn:active {
            transform: scale(0.95);
        }

        .chat-icon {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .cloud-icon {
            font-size: 2.2em;
            position: absolute;
            top: 8px;
        }

        .dots-icon {
            display: flex;
            gap: 4px;
            position: absolute;
            bottom: 18px;
        }

        .dot {
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }

        .chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            border: 2px solid #0b1220;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .kpi-value {
                font-size: 2em;
            }
            
            .chat-float-btn {
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">üëî</div>
                <h1 class="login-title">Dashboard CEO</h1>
                <p class="login-subtitle">Acceso Exclusivo Ejecutivo</p>
            </div>

            <div class="ceo-select">
                <div class="ceo-option" onclick="seleccionarCEO('braian')">
                    <div class="ceo-avatar">B</div>
                    <div class="ceo-name">Braian.R</div>
                </div>
                <div class="ceo-option" onclick="seleccionarCEO('cesar')">
                    <div class="ceo-avatar">C</div>
                    <div class="ceo-name">Cesar.C</div>
                </div>
            </div>

            <form class="login-form" onsubmit="iniciarSesion(event)">
                <div class="form-group">
                    <label>Usuario Seleccionado</label>
                    <input type="text" id="usuarioSeleccionado" readonly placeholder="Selecciona un CEO" required>
                </div>

                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="passwordInput" placeholder="Ingresa tu contrase√±a" required>
                </div>

                <button type="submit" class="btn-login" id="btnLogin" disabled>
                    üîê Ingresar al Dashboard
                </button>

                <div class="error-message" id="errorMessage">
                    ‚ùå Contrase√±a incorrecta. Intenta nuevamente.
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Dashboard Ejecutivo CEO</h1>
            <div class="header-info">
                <div class="fecha-actual" id="fechaActual"></div>
                <div class="ceo-header-user-section">
                    <span class="ceo-usuario-nombre" id="usuarioLogueado"></span>
                    <button class="refresh-btn" onclick="cargarDashboard()">üîÑ Actualizar</button>
                    <button class="refresh-btn ceo-btn-salir" onclick="cerrarSesion()">üö™ Salir</button>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">üíµ</div>
                    <div class="kpi-trend trend-up" id="trendVentas">+0%</div>
                </div>
                <div class="kpi-value" id="totalVentas">$0</div>
                <div class="kpi-label">Total Ventas del Mes</div>
                <div class="kpi-sublabel" id="ventasHoy">$0 hoy</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">üëî</div>
                    <div class="kpi-trend trend-up" id="trendComisionCEO">15%</div>
                </div>
                <div class="kpi-value" id="comisionCEO">$0</div>
                <div class="kpi-label">Comisi√≥n CEO (15%)</div>
                <div class="kpi-sublabel" id="comisionCEOHoy">$0 hoy</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">üö¥</div>
                    <div class="kpi-trend trend-up" id="trendComisionRep">85%</div>
                </div>
                <div class="kpi-value" id="comisionRepartidores">$0</div>
                <div class="kpi-label">Comisi√≥n Repartidores (85%)</div>
                <div class="kpi-sublabel">Del total de ventas</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">‚úÖ</div>
                    <div class="kpi-trend trend-up" id="trendCompletados">+0%</div>
                </div>
                <div class="kpi-value" id="pedidosCompletados">0</div>
                <div class="kpi-label">Pedidos Completados</div>
                <div class="kpi-sublabel" id="pedidosHoy">0 hoy</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">üì¶</div>
                    <div class="kpi-trend" id="trendActivos">0</div>
                </div>
                <div class="kpi-value" id="pedidosActivos">0</div>
                <div class="kpi-label">Pedidos Activos</div>
                <div class="kpi-sublabel">En proceso ahora</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-header">
                    <div class="kpi-icon">‚è≥</div>
                    <div class="kpi-trend" id="trendPendientes">0</div>
                </div>
                <div class="kpi-value" id="pedidosPendientes">0</div>
                <div class="kpi-label">Pedidos Pendientes</div>
                <div class="kpi-sublabel">Esperando asignaci√≥n</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìà Crecimiento de Usuarios</h3>
                <div class="chart-container">
                    <canvas id="chartCrecimiento"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>üè∑Ô∏è Distribuci√≥n por Categor√≠a</h3>
                <div class="chart-container">
                    <canvas id="chartCategorias"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card full-chart">
                <h3>üìä Pedidos por D√≠a (√öltimos 30 d√≠as)</h3>
                <div class="chart-container">
                    <canvas id="chartPedidosDiarios"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>üíµ Ingresos Mensuales</h3>
                <div class="chart-container">
                    <canvas id="chartIngresos"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>‚è±Ô∏è Tiempo Promedio de Entrega</h3>
                <div class="chart-container">
                    <canvas id="chartTiempoEntrega"></canvas>
                </div>
            </div>
        </div>

        <!-- Tables -->
        <div class="table-card">
            <h3>üèÜ Top 10 Comercios M√°s Activos</h3>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Comercio</th>
                        <th>Categor√≠a</th>
                        <th>Pedidos</th>
                        <th>Rating</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="topComercios"></tbody>
            </table>
        </div>

        <div class="table-card">
            <h3>üö¥ Top 10 Repartidores M√°s Activos</h3>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Repartidor</th>
                        <th>Entregas</th>
                        <th>Rating</th>
                        <th>Tiempo Promedio</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="topRepartidores"></tbody>
            </table>
        </div>

        <div class="table-card">
            <h3>‚≠ê Top 3 Mejor Calificados</h3>
            <table>
                <thead>
                    <tr>
                        <th>üèÖ</th>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Rating</th>
                        <th>Pedidos/Entregas</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="topCalificados"></tbody>
            </table>
        </div>

        <div class="table-card">
            <h3>üìã Configuraciones de Comercios</h3>
            <div class="ceo-configuraciones-header">
                <span class="ceo-configuraciones-subtitle">Actualizaciones recientes de informaci√≥n de comercios</span>
                <button onclick="refrescarConfiguraciones()" class="ceo-btn-refrescar">
                    üîÑ Refrescar
                </button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>üìÖ Fecha</th>
                        <th>üè™ Comercio</th>
                        <th>üìÇ Categor√≠a</th>
                        <th>üìû Tel√©fono</th>
                        <th>‚úâÔ∏è Email</th>
                        <th>üîß Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="configuracionesComercios"></tbody>
            </table>
        </div>
    </div>

    <!-- Bot√≥n Flotante de Chat -->
    <a href="chat-sistema.html" class="chat-float-btn" title="Abrir Chat en Tiempo Real">
        <div class="chat-icon">
            <div class="cloud-icon">‚òÅÔ∏è</div>
            <div class="dots-icon">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
        <div class="chat-badge" id="chatNotifications">0</div>
    </a>

    <script>
        // Actualizar fecha actual
        function actualizarFecha() {
            const now = new Date();
            const opciones = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('fechaActual').textContent = 
                now.toLocaleDateString('es-AR', opciones);
        }
        actualizarFecha();
        setInterval(actualizarFecha, 60000); // Actualizar cada minuto

        // Variables para gr√°ficos
        let chartCrecimiento, chartCategorias, chartPedidosDiarios, chartIngresos, chartTiempoEntrega;

        // Cargar dashboard
        async function cargarDashboard() {
            try {
                // Intentar cargar datos reales del servidor
                const response = await fetch('http://localhost:5501/api/dashboard/stats');
                
                if (response.ok) {
                    const statsReales = await response.json();
                    const datos = await combinarDatosRealesConSimulados(statsReales);
                    
                    actualizarKPIs(datos);
                    crearGraficos(datos);
                    cargarTablas(datos);
                    cargarConfiguracionesComercios();
                } else {
                    throw new Error('Servidor no disponible');
                }
            } catch (error) {
                console.error('Error cargando dashboard:', error);
                console.log('Usando datos de ejemplo...');
                // Fallback a datos simulados
                const datos = await simularDatos();
                actualizarKPIs(datos);
                crearGraficos(datos);
                cargarTablas(datos);
                cargarConfiguracionesComercios();
            }
        }

        // Combinar datos reales con simulados
        async function combinarDatosRealesConSimulados(statsReales) {
            const datosSimulados = await simularDatos();
            
            // Reemplazar stats reales
            datosSimulados.comercios = statsReales.comercios;
            datosSimulados.repartidores = statsReales.repartidores;
            datosSimulados.pedidos = statsReales.pedidos;
            datosSimulados.ingresos = statsReales.ingresos;
            
            return datosSimulados;
        }

        async function simularDatos() {
            // Simulaci√≥n de datos - reemplazar con llamadas API reales
            return {
                comercios: {
                    total: 156,
                    hoy: 8,
                    tendencia: 12
                },
                repartidores: {
                    total: 89,
                    hoy: 3,
                    tendencia: 8
                },
                pedidos: {
                    total: 2847,
                    hoy: 124,
                    tendencia: 25
                },
                ingresos: {
                    mes: 458900,
                    tendencia: 18
                },
                crecimientoMensual: [
                    { mes: 'Jul', comercios: 98, repartidores: 52 },
                    { mes: 'Ago', comercios: 112, repartidores: 61 },
                    { mes: 'Sep', comercios: 128, repartidores: 68 },
                    { mes: 'Oct', comercios: 141, repartidores: 75 },
                    { mes: 'Nov', comercios: 149, repartidores: 82 },
                    { mes: 'Dic', comercios: 156, repartidores: 89 }
                ],
                categorias: {
                    alimentacion: 42,
                    kiosco: 38,
                    bazar: 24,
                    indumentaria: 18,
                    salud: 15,
                    otros: 19
                },
                pedidosDiarios: Array.from({length: 30}, (_, i) => ({
                    dia: i + 1,
                    pedidos: Math.floor(Math.random() * 150) + 50
                })),
                ingresosMensuales: [
                    { mes: 'Jul', ingreso: 245000 },
                    { mes: 'Ago', ingreso: 298000 },
                    { mes: 'Sep', ingreso: 325000 },
                    { mes: 'Oct', ingreso: 387000 },
                    { mes: 'Nov', ingreso: 412000 },
                    { mes: 'Dic', ingreso: 458900 }
                ],
                tiempoEntrega: {
                    promedio: 28,
                    datos: [
                        { rango: '0-15 min', cantidad: 35 },
                        { rango: '15-30 min', cantidad: 45 },
                        { rango: '30-45 min', cantidad: 15 },
                        { rango: '45+ min', cantidad: 5 }
                    ]
                },
                topComercios: [
                    { nombre: 'Kiosco Central', categoria: 'kiosco', pedidos: 342, rating: 4.9, estado: 'Activo' },
                    { nombre: 'Panader√≠a Don Pan', categoria: 'alimentacion', pedidos: 298, rating: 4.8, estado: 'Activo' },
                    { nombre: 'Farmacia del Centro', categoria: 'salud', pedidos: 276, rating: 4.7, estado: 'Activo' },
                    { nombre: 'Bazar Todo Hogar', categoria: 'bazar', pedidos: 234, rating: 4.9, estado: 'Activo' },
                    { nombre: 'Supermercado Express', categoria: 'alimentacion', pedidos: 198, rating: 4.6, estado: 'Activo' },
                    { nombre: 'Kiosco 24hs', categoria: 'kiosco', pedidos: 187, rating: 4.8, estado: 'Activo' },
                    { nombre: 'Ropa Moda', categoria: 'indumentaria', pedidos: 156, rating: 4.5, estado: 'Activo' },
                    { nombre: 'Ferreter√≠a Central', categoria: 'otros', pedidos: 145, rating: 4.7, estado: 'Activo' },
                    { nombre: 'Verduler√≠a Fresh', categoria: 'alimentacion', pedidos: 134, rating: 4.9, estado: 'Activo' },
                    { nombre: 'Librer√≠a Escolar', categoria: 'otros', pedidos: 112, rating: 4.6, estado: 'Activo' }
                ],
                topRepartidores: [
                    { nombre: 'Juan P√©rez', entregas: 456, rating: 4.9, tiempo: '22 min', estado: 'Activo' },
                    { nombre: 'Mar√≠a Garc√≠a', entregas: 423, rating: 4.8, tiempo: '24 min', estado: 'Activo' },
                    { nombre: 'Carlos Rodr√≠guez', entregas: 398, rating: 4.9, tiempo: '21 min', estado: 'Activo' },
                    { nombre: 'Ana Mart√≠nez', entregas: 367, rating: 4.7, tiempo: '26 min', estado: 'Activo' },
                    { nombre: 'Diego L√≥pez', entregas: 342, rating: 4.8, tiempo: '23 min', estado: 'Activo' },
                    { nombre: 'Laura S√°nchez', entregas: 318, rating: 4.9, tiempo: '22 min', estado: 'Activo' },
                    { nombre: 'Pablo G√≥mez', entregas: 298, rating: 4.6, tiempo: '28 min', estado: 'Activo' },
                    { nombre: 'Sofia D√≠az', entregas: 276, rating: 4.8, tiempo: '25 min', estado: 'Activo' },
                    { nombre: 'Lucas Fern√°ndez', entregas: 254, rating: 4.7, tiempo: '27 min', estado: 'Activo' },
                    { nombre: 'Valentina Ruiz', entregas: 234, rating: 4.9, tiempo: '21 min', estado: 'Activo' }
                ]
            };
        }

        function actualizarKPIs(datos) {
            // Total Ventas
            document.getElementById('totalVentas').textContent = 
                `$${datos.ingresos.totalVentas.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('ventasHoy').textContent = 
                `$${datos.ingresos.ventasHoy.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} hoy`;
            document.getElementById('trendVentas').textContent = 
                `${datos.ingresos.tendencia >= 0 ? '+' : ''}${datos.ingresos.tendencia}%`;
            document.getElementById('trendVentas').className = 
                datos.ingresos.tendencia >= 0 ? 'kpi-trend trend-up' : 'kpi-trend trend-down';
            
            // Comisi√≥n CEO (15%)
            document.getElementById('comisionCEO').textContent = 
                `$${datos.ingresos.comisionCEO.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('comisionCEOHoy').textContent = 
                `$${datos.ingresos.comisionCEOHoy.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} hoy`;
            
            // Comisi√≥n Repartidores (85%)
            document.getElementById('comisionRepartidores').textContent = 
                `$${datos.ingresos.comisionRepartidores.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Pedidos Completados
            document.getElementById('pedidosCompletados').textContent = datos.pedidos.completados;
            document.getElementById('pedidosHoy').textContent = `${datos.pedidos.hoy} hoy`;
            
            // Pedidos Activos
            document.getElementById('pedidosActivos').textContent = datos.pedidos.activos;
            document.getElementById('trendActivos').textContent = datos.pedidos.activos;
            
            // Pedidos Pendientes
            document.getElementById('pedidosPendientes').textContent = datos.pedidos.pendientes;
            document.getElementById('trendPendientes').textContent = datos.pedidos.pendientes;
        }

        function crearGraficos(datos) {
            // Gr√°fico de Crecimiento
            if (chartCrecimiento) chartCrecimiento.destroy();
            const ctxCrecimiento = document.getElementById('chartCrecimiento').getContext('2d');
            chartCrecimiento = new Chart(ctxCrecimiento, {
                type: 'line',
                data: {
                    labels: datos.crecimientoMensual.map(d => d.mes),
                    datasets: [
                        {
                            label: 'Comercios',
                            data: datos.crecimientoMensual.map(d => d.comercios),
                            borderColor: '#06b6d4',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Repartidores',
                            data: datos.crecimientoMensual.map(d => d.repartidores),
                            borderColor: '#0891b2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de Categor√≠as
            if (chartCategorias) chartCategorias.destroy();
            const ctxCategorias = document.getElementById('chartCategorias').getContext('2d');
            chartCategorias = new Chart(ctxCategorias, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(datos.categorias).map(c => c.charAt(0).toUpperCase() + c.slice(1)),
                    datasets: [{
                        data: Object.values(datos.categorias),
                        backgroundColor: [
                            '#06b6d4',
                            '#0891b2',
                            '#f093fb',
                            '#4facfe',
                            '#43e97b',
                            '#fa709a'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico de Pedidos Diarios
            if (chartPedidosDiarios) chartPedidosDiarios.destroy();
            const ctxPedidosDiarios = document.getElementById('chartPedidosDiarios').getContext('2d');
            chartPedidosDiarios = new Chart(ctxPedidosDiarios, {
                type: 'bar',
                data: {
                    labels: datos.pedidosDiarios.map(d => `D√≠a ${d.dia}`),
                    datasets: [{
                        label: 'Pedidos',
                        data: datos.pedidosDiarios.map(d => d.pedidos),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#06b6d4',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Gr√°fico de Ingresos
            if (chartIngresos) chartIngresos.destroy();
            const ctxIngresos = document.getElementById('chartIngresos').getContext('2d');
            chartIngresos = new Chart(ctxIngresos, {
                type: 'line',
                data: {
                    labels: datos.ingresosMensuales.map(d => d.mes),
                    datasets: [{
                        label: 'Ingresos ($)',
                        data: datos.ingresosMensuales.map(d => d.ingreso),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Tiempo de Entrega
            if (chartTiempoEntrega) chartTiempoEntrega.destroy();
            const ctxTiempoEntrega = document.getElementById('chartTiempoEntrega').getContext('2d');
            chartTiempoEntrega = new Chart(ctxTiempoEntrega, {
                type: 'bar',
                data: {
                    labels: datos.tiempoEntrega.datos.map(d => d.rango),
                    datasets: [{
                        label: 'Entregas (%)',
                        data: datos.tiempoEntrega.datos.map(d => d.cantidad),
                        backgroundColor: [
                            '#10b981',
                            '#3b82f6',
                            '#f59e0b',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function cargarTablas(datos) {
            // Top Comercios
            const tbodyComercios = document.getElementById('topComercios');
            tbodyComercios.innerHTML = '';
            datos.topComercios.forEach((comercio, index) => {
                const row = `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td>${comercio.nombre}</td>
                        <td>${comercio.categoria}</td>
                        <td><strong>${comercio.pedidos}</strong></td>
                        <td>‚≠ê ${comercio.rating}</td>
                        <td><span class="badge badge-success">${comercio.estado}</span></td>
                    </tr>
                `;
                tbodyComercios.innerHTML += row;
            });

            // Top Repartidores
            const tbodyRepartidores = document.getElementById('topRepartidores');
            tbodyRepartidores.innerHTML = '';
            datos.topRepartidores.forEach((repartidor, index) => {
                const row = `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td>${repartidor.nombre}</td>
                        <td><strong>${repartidor.entregas}</strong></td>
                        <td>‚≠ê ${repartidor.rating}</td>
                        <td>${repartidor.tiempo}</td>
                        <td><span class="badge badge-success">${repartidor.estado}</span></td>
                    </tr>
                `;
                tbodyRepartidores.innerHTML += row;
            });

            // Top 3 Mejor Calificados (combinar comercios y repartidores)
            const tbodyCalificados = document.getElementById('topCalificados');
            tbodyCalificados.innerHTML = '';
            
            // Combinar y ordenar por rating
            const todosMejores = [
                ...datos.topComercios.map(c => ({...c, tipo: 'Comercio', cantidad: c.pedidos})),
                ...datos.topRepartidores.map(r => ({...r, tipo: 'Repartidor', cantidad: r.entregas}))
            ].sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating)).slice(0, 3);
            
            const medallas = ['ü•á', 'ü•à', 'ü•â'];
            todosMejores.forEach((item, index) => {
                const row = `
                    <tr>
                        <td style="font-size: 1.5em;">${medallas[index]}</td>
                        <td><strong>${item.nombre}</strong></td>
                        <td>${item.tipo}</td>
                        <td><strong>‚≠ê ${item.rating}</strong></td>
                        <td>${item.cantidad}</td>
                        <td><span class="badge badge-success">${item.estado}</span></td>
                    </tr>
                `;
                tbodyCalificados.innerHTML += row;
            });
        }

        // ==================== SISTEMA DE LOGIN ====================
        let ceoSeleccionado = null;
        const usuarios = {
            'braian': {
                nombre: 'Braian.R',
                password: 'Braian2026!',
                avatar: 'B'
            },
            'cesar': {
                nombre: 'Cesar.C',
                password: 'Cesar2026!',
                avatar: 'C'
            }
        };

        function seleccionarCEO(ceo) {
            ceoSeleccionado = ceo;
            
            // Actualizar UI
            document.querySelectorAll('.ceo-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Habilitar formulario
            document.getElementById('usuarioSeleccionado').value = usuarios[ceo].nombre;
            document.getElementById('btnLogin').disabled = false;
            document.getElementById('passwordInput').focus();
            
            // Limpiar error
            document.getElementById('errorMessage').classList.remove('active');
        }

        function iniciarSesion(event) {
            event.preventDefault();
            
            if (!ceoSeleccionado) {
                alert('Por favor selecciona un CEO');
                return;
            }
            
            const password = document.getElementById('passwordInput').value;
            const usuario = usuarios[ceoSeleccionado];
            
            if (password === usuario.password) {
                // Login exitoso
                localStorage.setItem('ceoDashboardUser', JSON.stringify({
                    nombre: usuario.nombre,
                    avatar: usuario.avatar,
                    loginTime: Date.now()
                }));
                
                mostrarDashboard(usuario);
            } else {
                // Error de contrase√±a
                document.getElementById('errorMessage').classList.add('active');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function mostrarDashboard(usuario) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').classList.add('active');
            document.getElementById('usuarioLogueado').textContent = `üë§ ${usuario.nombre}`;
            
            cargarDashboard();
        }

        function cerrarSesion() {
            if (confirm('¬øSeguro que quieres cerrar sesi√≥n?')) {
                localStorage.removeItem('ceoDashboardUser');
                location.reload();
            }
        }

        function verificarSesion() {
            const sesion = localStorage.getItem('ceoDashboardUser');
            
            if (sesion) {
                const usuario = JSON.parse(sesion);
                mostrarDashboard(usuario);
            }
        }

        // Actualizar contador de notificaciones de chat
        async function actualizarNotificacionesChat() {
            try {
                const response = await fetch('http://localhost:5501/api/conversaciones');
                if (response.ok) {
                    const conversaciones = await response.json();
                    // Contar conversaciones con mensajes nuevos (simulado - puedes mejorar la l√≥gica)
                    const mensajesNuevos = conversaciones.filter(c => c.ultimoMensaje && !c.leido).length || 0;
                    
                    const badge = document.getElementById('chatNotifications');
                    if (badge) {
                        badge.textContent = mensajesNuevos;
                        badge.style.display = mensajesNuevos > 0 ? 'flex' : 'none';
                    }
                }
            } catch (error) {
                console.log('No se pudieron cargar notificaciones de chat');
            }
        }

        // Cargar configuraciones de comercios
        async function cargarConfiguracionesComercios() {
            try {
                const response = await fetch('http://localhost:5501/api/registros/ceo/configuraciones-comercios');
                
                if (response.ok) {
                    const data = await response.json();
                    const tbody = document.getElementById('configuracionesComercios');
                    
                    if (data.success && data.configuraciones && data.configuraciones.length > 0) {
                        tbody.innerHTML = data.configuraciones.slice(0, 20).map(config => {
                            const fecha = new Date(config.fecha);
                            const fechaFormateada = fecha.toLocaleDateString('es-AR', {
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            return `
                                <tr>
                                    <td>${fechaFormateada}</td>
                                    <td><strong>${config.nombre || 'Sin nombre'}</strong></td>
                                    <td><span style="background: rgba(6, 182, 212, 0.2); padding: 4px 12px; border-radius: 12px; font-size: 0.85em;">${config.categoria || 'general'}</span></td>
                                    <td>${config.telefono || 'N/A'}</td>
                                    <td>${config.email || 'N/A'}</td>
                                    <td>
                                        <button onclick="verDetalleConfiguracion('${config.comercioId}')" 
                                                style="background: #06b6d4; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                            üëÅÔ∏è Ver
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    } else {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;">
                                    üìã No hay configuraciones registradas a√∫n
                                </td>
                            </tr>
                        `;
                    }
                } else {
                    throw new Error('Error al cargar configuraciones');
                }
            } catch (error) {
                console.error('Error cargando configuraciones:', error);
                const tbody = document.getElementById('configuracionesComercios');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #f56565;">
                            ‚ö†Ô∏è Error al cargar configuraciones
                        </td>
                    </tr>
                `;
            }
        }

        // Refrescar configuraciones
        function refrescarConfiguraciones() {
            cargarConfiguracionesComercios();
        }

        // Ver detalle de configuraci√≥n
        function verDetalleConfiguracion(comercioId) {
            alert(`üìã Detalle de configuraci√≥n del comercio: ${comercioId}\n\n(Funcionalidad completa en desarrollo)`);
        }

        // Verificar sesi√≥n al cargar
        window.addEventListener('DOMContentLoaded', () => {
            verificarSesion();
            
            // Actualizar notificaciones de chat cada 30 segundos
            actualizarNotificacionesChat();
            setInterval(actualizarNotificacionesChat, 30000);
        });

        // Cargar al iniciar (solo si hay sesi√≥n activa)
        // window.addEventListener('DOMContentLoaded', cargarDashboard); // REMOVIDO - ahora se llama desde mostrarDashboard
    </script>
</body>
</html>

