ğŸ“‹ GUÃA DE INTEGRACIÃ“N - Agregar Endpoints Nuevos a server.js

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: UBICAR DONDE INSERTAR EL CÃ“DIGO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Abre server.js y busca esta lÃ­nea (aproximadamente lÃ­nea 1850):

    app.get('/api/analytics/dashboard', async (req, res) => {
      // ... cÃ³digo existente ...
    });

DESPUÃ‰S de este endpoint (lÃ­nea ~1900), insertarÃ¡s todo el cÃ³digo nuevo.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 2: CÃ“DIGO A AGREGAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Copia TODO el contenido de: NUEVOS_ENDPOINTS.txt

Este archivo contiene 400+ lÃ­neas con:
â”œâ”€ Endpoints de Calificaciones (3 endpoints)
â”œâ”€ Endpoints de Logros (2 endpoints)
â”œâ”€ Endpoints de GeolocalizaciÃ³n (2 endpoints)
â”œâ”€ Endpoints de Promociones (3 endpoints)
â””â”€ Funciones auxiliares

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 3: INSERCIÃ“N RÃPIDA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MÃ©todo 1 - Manual (Recomendado):
1. Abre NUEVOS_ENDPOINTS.txt
2. Selecciona desde "// ============================================"
   hasta el final del archivo
3. Copia (Ctrl+C)
4. Abre server.js
5. Busca la lÃ­nea comentada "// ============================================"
   que estÃ¡ despuÃ©s de /api/analytics/dashboard
6. Coloca el cursor ahÃ­ (lÃ­nea ~1900)
7. Pega (Ctrl+V)
8. Guarda el archivo

MÃ©todo 2 - AutomÃ¡tico (Usando PowerShell):
Crea un script PowerShell:

```powershell
$serverJs = Get-Content "server.js" -Raw
$newCode = Get-Content "NUEVOS_ENDPOINTS.txt" -Raw

# Encontrar punto de inserciÃ³n (despuÃ©s de /api/analytics/dashboard)
$insertPoint = $serverJs.LastIndexOf("});") + 4

$updatedJs = $serverJs.Insert($insertPoint, "`n`n" + $newCode)
Set-Content "server.js" $updatedJs -Encoding UTF8

Write-Host "âœ… CÃ³digo integrado exitosamente"
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 4: VERIFICAR INTEGRACIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DespuÃ©s de pegar el cÃ³digo, verifica:

1. âœ… No hay errores de sintaxis (busca "}" desapareados)
2. âœ… Las funciones notificar* estÃ¡n definidas (bÃºsqueda: "function notificar")
3. âœ… Las rutas de archivos son correctas (BASE_DIR)
4. âœ… Todas las importaciones necesarias estÃ¡n arriba

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 5: DEPENDENCIAS REQUERIDAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Verifica que package.json tenga:

```json
{
  "dependencies": {
    "express": "^4.x",
    "cors": "^2.x",
    "socket.io": "^4.x",
    "nodemailer": "^6.x",
    "web-push": "^3.x"
  }
}
```

Si falta alguno, instala:
npm install socket.io web-push

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 6: REINICIA EL SERVIDOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Abre terminal en el directorio del proyecto:

PowerShell:
```powershell
# Detener servidor anterior
Stop-Process -Name node -Force -ErrorAction SilentlyContinue

# Esperar
Start-Sleep -Seconds 2

# Iniciar con nuevo cÃ³digo
node server.js
```

Bash/Terminal:
```bash
killall node 2>/dev/null || true
sleep 2
node server.js
```

DeberÃ­as ver:
  âœ… Server listening on port 5501
  âœ… Todos los endpoints registrados

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 7: PROBAR ENDPOINTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Usa una herramienta como Postman, curl, o VS Code Thunder Client:

1. PROBAR CALIFICACIONES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST http://localhost:5501/api/calificaciones
Content-Type: application/json

{
  "pedidoId": "PED-001",
  "repartidorId": "REP-01",
  "clienteId": "CLI-01",
  "estrellas": 5,
  "comentario": "Â¡Excelente servicio!",
  "aspecto": {
    "puntualidad": 5,
    "amabilidad": 5,
    "limpieza": 4,
    "exactitud": 5
  }
}

Esperado: { "success": true, "calificacion": { ... } }


2. PROBAR LOGROS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST http://localhost:5501/api/logros/desbloquear
Content-Type: application/json

{
  "repartidorId": "REP-01",
  "logro": {
    "id": "PRIMER_PEDIDO",
    "nombre": "ğŸš€ Primeros Pasos",
    "descripcion": "Completar tu primer pedido",
    "icono": "ğŸš€",
    "color": "#667eea"
  }
}

Esperado: { "success": true, "logros": [ ... ] }


3. PROBAR GEOLOCALIZACIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST http://localhost:5501/api/ubicacion/actualizar
Content-Type: application/json

{
  "repartidorId": "REP-01",
  "lat": -34.6037,
  "lng": -58.3816,
  "accuracy": 5
}

Esperado: { "success": true }


4. PROBAR PROMOCIONES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST http://localhost:5501/api/promociones
Content-Type: application/json

{
  "nombre": "Black Friday",
  "tipo": "descuento",
  "valor": 15,
  "codigo": "BLACKFRI2025",
  "descripcion": "15% descuento en todo",
  "vigencia": {
    "desde": "2025-12-13",
    "hasta": "2025-12-15"
  },
  "usoMaximo": 1000
}

Esperado: { "success": true, "promocion": { ... } }


5. VALIDAR PROMOCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST http://localhost:5501/api/promociones/BLACKFRI2025/validar

Esperado: { "success": true, "promocion": { ... } }


6. OBTENER CALIFICACIONES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET http://localhost:5501/api/repartidores/REP-01/calificaciones

Esperado: { "success": true, "calificaciones": [ ... ], "estadisticas": { ... } }


7. OBTENER RANKING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET http://localhost:5501/api/repartidores/ranking/top?limite=10

Esperado: { "success": true, "ranking": [ ... ] }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 8: CONECTAR FRONTEND
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

En los HTML nuevos (panel-*-pro.html), verifica que:

1. Socket.IO estÃ© conectando:
   const socket = io('http://localhost:5501');

2. Las URLs de API sean correctas:
   fetch('http://localhost:5501/api/calificaciones', { ... })

3. Los scripts de temas y geo estÃ©n cargados:
   <script src="js/theme.js"></script>
   <script src="js/geo.js"></script>
   <script src="js/ratings.js"></script>

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 9: CONFIGURACIÃ“N FINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. GOOGLE MAPS API (Opcional pero recomendado)
   âœ Obtener key: https://console.cloud.google.com
   âœ Reemplazar en js/geo.js lÃ­nea 6
   âœ Reemplazar en HTML donde estÃ¡: YOUR_GOOGLE_MAPS_API_KEY

2. EMAIL CONFIGURATION (JÃ¡ configurado en server.js)
   âœ Si es Gmail, generar App Password:
      https://myaccount.google.com/apppasswords
   âœ Reemplazar en server.js lÃ­neas 38-44

3. SOCKET.IO CORS (ProducciÃ³n)
   âœ Cambiar lÃ­nea 17-20 de:
      origin: "*"
      A: origin: ["https://tudominio.com"]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PASO 10: TESTING COMPLETO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… Todos los paneles cargan sin errores
âœ… Modo oscuro/claro funciona
âœ… Socket.IO conecta (ver console: "âœ… Conectado")
âœ… Endpoints responden (probar con Postman)
âœ… Chat real-time funciona
âœ… Mapas cargan (si estÃ¡ configurado API key)
âœ… Calificaciones se guardan
âœ… Logros se desbloquean
âœ… Promociones se validan

Si algo no funciona:
1. Abre DevTools (F12)
2. Mira la consola (Console tab)
3. Busca errores en rojo
4. Verifica que las URLs sean correctas

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ ERRORES COMUNES Y SOLUCIONES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ERROR: Cannot POST /api/calificaciones
â†³ SoluciÃ³n: El cÃ³digo no fue pegado correctamente en server.js

ERROR: Socket.IO connection refused
â†³ SoluciÃ³n: Socket.IO no estÃ¡ iniciado. Verifica que server.js use:
   server.listen(PORT) no app.listen(PORT)

ERROR: res.json is not a function
â†³ SoluciÃ³n: Verifica que req, res tengan los parametros correctamente

ERROR: Cannot read property 'mkdir' of undefined
â†³ SoluciÃ³n: Falta const fs = require('fs').promises al inicio

ERROR: Theme not applying
â†³ SoluciÃ³n: Verifica que styles/theme.css estÃ© cargado
   <link rel="stylesheet" href="styles/theme.css">

ERROR: Google Maps not loading
â†³ SoluciÃ³n: API Key no configurada o invÃ¡lida
   Obtener en: https://console.cloud.google.com

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… CHECKLIST FINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Server.js:
â˜ NUEVOS_ENDPOINTS.txt pegado completo
â˜ Sin errores de sintaxis
â˜ server.listen() usado (no app.listen())
â˜ Socket.IO configurado
â˜ Nodemailer configurado

Archivos Frontend:
â˜ js/theme.js presente
â˜ js/geo.js presente
â˜ js/ratings.js presente
â˜ styles/theme.css presente
â˜ panel-repartidor-pro.html presente
â˜ panel-cliente-pro.html presente
â˜ panel-comercio-pro.html presente

DocumentaciÃ³n:
â˜ docs/YAVOY_PRO_FEATURES.md leÃ­do
â˜ NUEVOS_ENDPOINTS.txt pegado en server.js
â˜ YAVOY_PRO_SETUP.txt guardado

Testing:
â˜ Servidor inicia sin errores
â˜ Todos los paneles cargan
â˜ Socket.IO conecta
â˜ Endpoints responden
â˜ Chat funciona
â˜ Temas funcionan

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¡LISTO! Ya puedes usar YAVOY PRO 2.0 completo con todas las caracterÃ­sticas.

PrÃ³xima fase:
1. Implementar seguridad (JWT, validaciÃ³n, rate limiting)
2. Conectar base de datos real (MongoDB/Firebase)
3. Configurar CI/CD para deployment
4. Testing exhaustivo
5. Documentar API OpenAPI/Swagger
6. Deploy a producciÃ³n

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
